I"Ö <blockquote>
  <p>åœ¨è®¡ç®—æœºå­¦ä¸­ï¼Œåå°„ï¼ˆè‹±è¯­ï¼šreflectionï¼‰æ˜¯æŒ‡è®¡ç®—æœºç¨‹åºåœ¨è¿è¡Œæ—¶ï¼ˆruntimeï¼‰å¯ä»¥è®¿é—®ã€æ£€æµ‹å’Œä¿®æ”¹å®ƒæœ¬èº«çŠ¶æ€æˆ–è¡Œä¸ºçš„ä¸€ç§èƒ½åŠ›ã€‚[1]ç”¨æ¯”å–»æ¥è¯´ï¼Œåå°„å°±æ˜¯ç¨‹åºåœ¨è¿è¡Œçš„æ—¶å€™èƒ½å¤Ÿâ€œè§‚å¯Ÿâ€å¹¶ä¸”ä¿®æ”¹è‡ªå·±çš„è¡Œä¸ºã€‚</p>
</blockquote>

<p>ä»¥ä¸Šæ˜¯ç»´åŸºç™¾ç§‘ä¸­å¯¹åå°„çš„è§£é‡Šã€‚æˆ‘çš„ç†è§£åå°„æ˜¯åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œè·å–å’Œä¿®æ”¹æœªçŸ¥å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•çš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚</p>

<p>åå°„åœ¨ä¸€å®šç¨‹åº¦ä¸Šæä¾›äº†çµæ´»æ€§å’Œé€šç”¨æ€§ï¼Œæ˜¯ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­æ ¹æ®å®é™…éœ€è¦æ‰§è¡Œé¢å¤–çš„æ“ä½œã€‚åŒæ—¶åå°„é™ä½äº†ä»£ç çš„å¯è¯»æ€§ï¼Œä¸ºå›¢é˜Ÿé—´çš„åä½œåˆ¶é€ äº†ä¸€å®šçš„éšœç¢ã€‚</p>

<p>åå°„å¹¿æ³›åº”ç”¨äºè½¯ä»¶æµ‹è¯•ä¸­ï¼Œåœ¨è¿è¡Œä¸­åˆ›å»ºå’Œå®ä¾‹åŒ–å¯¹è±¡ï¼Œå¹¶æ“ä½œå±æ€§å’Œæ–¹æ³•ã€‚</p>

<h2 id="python-ä¸­çš„åå°„">Python ä¸­çš„åå°„</h2>
<p>Python ä¸­åå°„çš„æ–¹æ³•ï¼š</p>
<ul>
  <li><code>hasattr(obj, name)</code>: åˆ¤æ–­å¯¹è±¡ä¸­æ˜¯å¦æœ‰ä»¥ name å‘½åçš„å±æ€§æˆ–æ–¹æ³•ã€‚</li>
  <li><code>getattr(obj, name)</code>: è·å–å¯¹è±¡ä¸­ä»¥ name å‘½åçš„å±æ€§æˆ–æ–¹æ³•ï¼Œå¦‚æœæ˜¯å±æ€§è·å–åˆ°å°†æ˜¯å±æ€§çš„å€¼ï¼Œå¦‚æœæ˜¯æ–¹æ³•è·å–åˆ°çš„æ˜¯æ–¹æ³•çš„å®ä¾‹ã€‚</li>
  <li><code>setattr(obj, name, value)</code>: ä¸ºå¯¹è±¡è®¾ç½®ä¸€ä¸ªä»¥ value ä¸ºå€¼ä»¥ name ä¸ºåçš„å±æ€§æˆ–æ–¹æ³•ã€‚</li>
  <li><code>delattr(obj, name)</code>: åˆ é™¤å¯¹è±¡ä¸­ä»¥ name ä¸ºåç§°çš„å±æ€§æˆ–æ–¹æ³•ã€‚</li>
  <li><code>dir([obj])</code>: è¯¥æ–¹æ³•è¿”å›å¯¹è±¡å¤§å¤šæ•°å±æ€§åçš„åˆ—è¡¨ã€‚</li>
</ul>

<p>åå°„ä¸­æ–¹æ³•çš„ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<pre><code class="language-python">class Test():
    def __init__(self, name):
        self.name = name

    def say(self):
        print('Hello ' + self.name)

test = Test("keinYe")
if hasattr(test, 'name'):
    print('name = %s' % getattr(test, 'name'))
    setattr(test, 'name', 'python')
    print('name = %s' % getattr(test, 'name'))
else:
    print("The attribute 'name' not exist in Test")

delattr(test, 'name')
if not hasattr(test, 'name'):
    print('name is deleted')
    setattr(test, 'name', 'python')
    print('name = %s' % getattr(test, 'name'))

attr = dir(test)
print(attr)
</code></pre>
<p>è¿è¡Œä»¥ä¸Šä»£ç ï¼Œä½ å°†å¾—åˆ°ä»¥ä¸‹ç»“æœï¼š</p>
<pre><code class="language-shell">name = keinYe
name = python
name is deleted
name = python
['__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__str__', '__subclasshook__', '__weakref__', 'name', 'say']
</code></pre>
<p>åœ¨ä½¿ç”¨ <code>dir</code> å‡½æ•°è·å–å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°å¾ˆå¤šä»¥ <code>__</code> å¼€å¤´å’Œç»“å°¾çš„å±æ€§ï¼Œæˆ‘ä»¬æœ¬èº«å¹¶æ²¡æœ‰å®šä¹‰è¿™äº›å±æ€§ï¼Œè¿™äº›å±æ€§æ˜¯ python è‡ªåŠ¨æ·»åŠ çš„ï¼Œå®ƒä»¬ä¿å­˜äº†å¯¹è±¡çš„å…ƒæ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥å»è¯»å–è¿™äº›å±æ€§ï¼Œä½†æ˜¯å°½é‡ä¸è¦ä¿®æ”¹ä»–ä»¬ï¼Œä»¥å…å¼•èµ·ä¸å¿…è¦çš„é”™è¯¯ã€‚</p>

<h3 id="åˆ¤æ–­è·å–åˆ°çš„å¯¹è±¡æ˜¯å¦æ˜¯æ–¹æ³•å‡½æ•°">åˆ¤æ–­è·å–åˆ°çš„å¯¹è±¡æ˜¯å¦æ˜¯æ–¹æ³•/å‡½æ•°</h3>
<p>é€šè¿‡åå°„è·å–åˆ°çš„å¯¹è±¡æœ‰å±æ€§ä¹Ÿæœ‰æ–¹æ³•æˆ–å‡½æ•°ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•åˆ¤æ–­è·å–åˆ°çš„å¯¹è±¡æ˜¯å¦æ˜¯æ–¹æ³•æˆ–å‡½æ•°ã€‚</p>
<ol>
  <li>åˆ¤æ–­æ˜¯å¦å…·æœ‰ <code>__call__</code> å±æ€§
    <pre><code class="language-python">add = lambda a, b:a+b
if hasattr(add, '__call__'):
    print(add(1, 2))
</code></pre>
  </li>
  <li>åˆ©ç”¨ <code>callable</code> åˆ¤æ–­
    <pre><code class="language-python">if callable(add):
    print(add(1, 2))
</code></pre>
  </li>
  <li>åˆ©ç”¨ <code>inspect</code> æ¨¡å—ä¸­çš„ <code>isfunction</code> å‡½æ•°åˆ¤æ–­
    <pre><code class="language-python">from inspect import isfunction
if isfunction(add):
    print(add(1, 2))
</code></pre>
    <blockquote>
      <p>æ³¨æ„ï¼š<code>isfunction</code> å‡½æ•°æ— æ³•åˆ¤æ–­ç±»ä¸­çš„æ–¹æ³•ã€‚</p>
    </blockquote>

    <p>Pythonçš„inspectæ¨¡å—åŒ…å«äº†å¤§é‡çš„ä¸åå°„ã€å…ƒæ•°æ®ç›¸å…³çš„å·¥å…·å‡½æ•°ã€‚</p>
  </li>
  <li>ä½¿ç”¨<code>types.MethodType</code> æˆ– <code>types.FunctionType</code> æ¥åˆ¤æ–­ã€‚
ä»¥ä¸‹ä»£ç æ— æ•ˆ
    <pre><code>from inspect import isfunction
import types

class Test():
    def __init__(self, name):
        self.name = name

    def say(self):
        print('Hello ' + self.name)

test = Test("keinYe")
print(type(test.say))
print(type(isfunction))
print(type(print))
if isinstance(isfunction, types.FunctionType):
    print(True)
if isinstance(test.say, types.MethodType):
    print(True)
if isinstance(print, types.BuiltinMethodType):
    print(True)   
</code></pre>
    <p>ä»¥ä¸Šä»£ç è¾“å‡ºç»“æœ</p>
    <pre><code class="language-shell">&lt;class 'method'&gt;
&lt;class 'function'&gt;
&lt;class 'builtin_function_or_method'&gt;
True
True
True
</code></pre>
    <blockquote>
      <p>æ³¨æ„ï¼š<code>print</code> ç­‰ python å†…ç½®å‡½æ•°/æ–¹æ³•ï¼Œä½¿ç”¨ <code>type</code> å‡½æ•°è·å–åˆ°çš„ç±»å‹å°†æ˜¯ <code>&lt;class 'builtin_function_or_method'&gt;</code>ã€‚</p>
    </blockquote>
  </li>
</ol>

<h3 id="æ–¹æ³•å‡½æ•°çš„ä½¿ç”¨">æ–¹æ³•/å‡½æ•°çš„ä½¿ç”¨</h3>

<p>å½“ä½¿ç”¨åå°„è·å–åˆ°æ–¹æ³•æˆ–å‡½æ•°çš„å¯¹è±¡åï¼Œå¯ä»¥ç›´æ¥åœ¨ååŠ ä¸Šæ‹¬å·è¿›è¡Œè®¿é—®ã€Œå‰ææ˜¯è¯¥å‡½æ•°æ²¡æœ‰å‚æ•°ã€ã€‚</p>
<pre><code class="language-python">func = getattr(test, 'say')
if hasattr(func, '__call__'):
    func()
</code></pre>

<p>å¦‚æœæ–¹æ³•/å‡½æ•°æœ‰å‚æ•°ï¼Œé‚£ä¹ˆä»¥ä¸Šè°ƒç”¨æ–¹æ³•å°†ä¼šæŠ¥ <code>TypeError</code>ã€‚é‚£ä¹ˆæˆ‘ä»¬å¦‚æœæ¥è·å–å‡½æ•°çš„å‚æ•°å‘¢ï¼Œä½¿ç”¨ <code>inspect</code> æ¨¡å—çš„ <code>getfullargspec</code> å‡½æ•°æ¥è·å–å‚æ•°åˆ—è¡¨ã€‚</p>
<pre><code>func = getattr(test, 'say')
if hasattr(func, '__call__'):
    args = inspect.getfullargspec(func)
    print(args.args)
</code></pre>
<p>æ‰§è¡Œä»¥ä¸Šä»£ç ï¼Œå°†å¾—åˆ°ä»¥ä¸‹ç»“æœï¼š</p>
<pre><code class="language-shell">['self']
</code></pre>
<p>ç”±äº <code>say</code> æ˜¯ç±»æ–¹æ³•ï¼Œå…¶ç¬¬ä¸€ä¸ªå‚æ•°æ€»æ˜¯ <code>self</code>ï¼Œæ­¤æ—¶å¦‚æœæˆ‘ä»¬åœ¨ <code>say</code> æ–¹æ³•ä¸Šæ–°å¢ä¸€ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è·å–åˆ°çš„å‚æ•°åˆ—è¡¨çš„å˜åŒ–ã€‚</p>
<pre><code class="language-python">class Test():
    def __init__(self, name, age):
        self.name = name
        self.age = age

    def say(self, time):
        print('Hello ' + self.name)

test = Test('keinYe', 20)

func = getattr(test, 'say')
if hasattr(func, '__call__'):
    args = inspect.getfullargspec(func)
    print(args.args)
</code></pre>
<p>æ­¤æ—¶æˆ‘ä»¬å°†å¾—åˆ° <code>say</code> æ–¹æ³•çš„ä¸¤ä¸ªå‚æ•° <code>self</code> å’Œ <code>time</code>ã€‚</p>

<h2 id="åå°„çš„åº”ç”¨">åå°„çš„åº”ç”¨</h2>
<p>åœ¨ä½¿ç”¨ python è¿›è¡Œç½‘ç»œé€šä¿¡æ—¶ï¼Œä¸å¯é¿å…çš„ä¼šä½¿ç”¨åˆ° json æ ¼å¼ï¼Œé‚£ä¹ˆå°†ä¸€ä¸ªç±»è½¬æ¢ä¸º json æˆ–å°†ä¸€ä¸ª json è½¬æ¢ä¸ºç±»å¯¹è±¡ï¼Œå¦‚æœæ¯æ¬¡éƒ½æ‰‹åŠ¨å°†ç±»å±æ€§è½¬æ¢ä¸º json æ•°æ®ï¼Œé‚£ä¹ˆå°†æ˜¯ä¸€ä¸ªéå¸¸è´¹åŠ›ä¸è®¨å¥½çš„å·¥ä½œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åå°„æ¥å®ç°ï¼Œè®©æ¯ä¸ªæ•°æ®ç±»ç»§æ‰¿è¿™äº›æ–¹æ³•ï¼Œå³å¯å®ç°ä¸€æ¬¡ç¼–ç¨‹åˆ°å¤„ä½¿ç”¨ã€‚</p>

<p>ä»¥ä¸‹æ˜¯ç¤ºä¾‹ä»£ç ï¼š</p>
<pre><code>import json

class Base(object):
    def to_json(self):
        attrs = dir(self)
        json_dict = {}
        for attr in attrs:
            if attr.startswith('_') or attr.endswith('_'):
                continue
            attr_obj = getattr(self, attr)
            if hasattr(attr_obj, '__call__'):
                continue
            json_dict[attr] = attr_obj
        return json.dumps(json_dict)

    def to_object(self, json_str):
        json_dict = json.loads(json_str)
        attrs = dir(self)
        for attr in attrs:
            if attr.startswith('_') or attr.endswith('_'):
                continue
            if hasattr(attr, '__call__'):
                continue
            if attr in json_dict:
                setattr(self, attr, json_dict.get(attr))            

class Person(Base):
    def __init__(self, name=None, age=None):
        self.name = name
        self.age = age
    
    def say(self):
        print('name = %s, age = %s' % (self.name, self.age))

person1 = Person('keinYe', 25)
print(person1.to_json())
person2 = Person()
json_str = '{"name":"test", "age": 27}'
person2.to_object(json_str)
person2.say()
</code></pre>
<p>æ‰§è¡Œä»¥ä¸Šä»£ç å°†å¾—åˆ°ä»¥ä¸‹ç»“æœï¼š</p>
<pre><code class="language-shell">{"age": 25, "name": "keinYe"}
name = None, age = None
name = test, age = 27
</code></pre>
:ET